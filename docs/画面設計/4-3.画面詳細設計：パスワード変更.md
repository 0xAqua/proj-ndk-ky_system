## 4.3 パスワード変更画面（V000030）

### 4.3.1. 概要

本画面は、ログイン時に「パスワードをお忘れですか？」リンクを押下したユーザーが、登録済みメールアドレス宛に送信された認証コードを用いて、新しいパスワードを再設定するための画面である。

ユーザーは認証コード・新しいパスワード・確認用パスワードを入力し、変更を確定する。

### 4.3.2. 画面レイアウト

img

### 4.3.3. 画面項目一覧

**凡例**

- **【種別】** A:リンク／B:ボタン／T:テキストボックス／S:ラベル
- **【属性】** H:半角／M:混在

| No   | 画面項目名         | 種別 | I/O  | 必須 | 属性 | 桁数 | API名 | 項目名 | 初期値             | 備考                                                         |
| ---- | ------------------ | ---- | ---- | ---- | ---- | ---- | ----- | ------ | ------------------ | ------------------------------------------------------------ |
| 1    | タイトル           | S    | -    | -    | -    | -    | -     | -      | 「パスワード変更」 | 全テナント共通                                               |
| 2    | 案内テキスト       | S    | -    | -    | -    | -    | -     | -      | -                  | 「登録済みメールアドレスに送信された認証コードを入力してください」 |
| 3    | メールアドレス     | T    | I    | ○    | H    | 255  | -     | -      | -                  | 入力補助あり（半角）                                         |
| 4    | 認証コード         | T    | I    | ○    | H    | 6    | -     | -      | -                  | メールに記載されたコード                                     |
| 5    | 新しいパスワード   | T    | I    | ○    | M    | 64   | -     | -      | -                  | マスク入力                                                   |
| 6    | 確認用パスワード   | T    | I    | ○    | M    | 64   | -     | -      | -                  | 入力一致確認                                                 |
| 7    | パスワード変更     | B    | O    | -    | -    | -    | -     | -      | -                  | API呼出                                                      |
| 8    | ログイン画面へ戻る | A    | -    | -    | -    | -    | -     | -      | -                  | 遷移リンク                                                   |

<p style="text-align: center;"><strong>表 4-4 パスワード変更画面項目一覧</strong></p>

### 4.3.4. 画面アクション定義

| No   | イベント名                     | アクション内容                                               | 遷移先                  |
| ---- | ------------------------------ | ------------------------------------------------------------ | ----------------------- |
| 1    | 「パスワード変更」クリック     | 入力内容を検証し、成功時にパスワードを更新後ログイン画面へ遷移 | ログイン画面（V000010） |
| 2    | 「ログイン画面へ戻る」クリック | 認証コード入力をキャンセルしログイン画面へ戻る               | ログイン画面（V000010） |

<p style="text-align:center;"><strong>表 4-5 パスワード変更アクション定義一覧</strong></p>

### 4.3.5. バリデーション・エラー処理

（1）入力項目バリデーション

| No   | 項目名           | チェック内容                                                 | エラーメッセージ                             | チェックタイミング       |
| ---- | ---------------- | ------------------------------------------------------------ | -------------------------------------------- | ------------------------ |
| 1    | メールアドレス   | 必須／形式チェック                                           | 「正しいメールアドレスを入力してください」   | 「パスワード変更」押下時 |
| 2    | 認証コード       | 必須／6桁チェック                                            | 「6桁の認証コードを入力してください」        | 同上                     |
| 3    | 新しいパスワード | 必須／桁数チェック（64文字以内）                             | 「パスワードは64文字以内で入力してください」 | 同上                     |
| 4    | 新しいパスワード | 強度チェック（英大文字・小文字・数字・記号を含む16文字以上推奨） | 「推奨形式に合致していません」               | 同上                     |
| 5    | 確認用パスワード | 一致チェック                                                 | 「確認用パスワードが一致しません」           | 同上                     |

<p style="text-align: center;"><strong>表 4-6 入力項目バリデーション一覧</strong></p>

（2）認証・更新エラー処理

| No   | エラー条件               | エラーメッセージ                                         | 処理内容                     | 備考          |
| ---- | ------------------------ | -------------------------------------------------------- | ---------------------------- | ------------- |
| 1    | 認証コード不正／期限切れ | 「認証コードが無効です。再度お試しください」             | 入力欄クリア、再送リンク表示 | 有効期限：5分 |
| 2    | メール未登録             | 「該当するメールアドレスが登録されていません」           | -                            | -             |
| 3    | システムエラー           | 「エラーが発生しました。時間をおいて再度お試しください」 | ログ記録                     | 詳細非表示    |

（3）エラー表示仕様

エラーメッセージは画面上部（タイトルと入力フォームの間）に表示する。 各エラーパターンの表示例を以下に示す。

[図3-X] エラー表示パターン一覧

- **表示位置**：画面上部（タイトルと入力フォームの間）
- **表示形式**：赤枠または赤背景のメッセージボックス
- **複数エラー**：複数発生時はリスト形式で全て表示
- **クリア条件**：「戻る」押下または入力修正時

### 4.3.6. セキュリティ要件

- 通信はすべて **HTTPS（TLS1.2以上）** を使用。
- パスワードは入力時にマスク表示し、オートコンプリート無効化。
- 認証コードは6桁の一時コードで、生成後 **5分間** で無効化。
- 検証成功後、トークンを即時破棄し再利用を防止。
- 入力情報はブラウザキャッシュ対象外とする。
- パスワードはサーバー側でソルト付きハッシュ（例：bcrypt）で保存する。

### 4.3.7. 表示制御（ComponentLabelMaster対応）

- 本画面は共通機能であり、`ComponentLabelMaster` による **ラベル可変／表示制御の対象外**。
- 案内文・入力項目・ボタン文言は全テナント共通。
- UI構成（入力欄やラベルの有無）は固定で、変更不可。
- ログイン画面・OTP画面と同様、テナント差分は適用しない。