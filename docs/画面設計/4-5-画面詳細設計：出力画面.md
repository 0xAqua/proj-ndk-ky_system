## 4.5 出力画面（V000050）

### 4.5.1 概要

本画面は、入力画面（V000040）で送信された工事情報をもとに、RAG（Retrieval-Augmented Generation）によって推定された危険予知結果を表示する。

VQシステムは、入力内容に関連する過去の事故事例や情報を検索・分析し、関連度の高いケースを上位3件まで表示する。

各ケースは「カード形式」で表示され、クリック（またはタップ）により詳細情報（概要・対応策）を展開する。

初期状態ではスケルトン表示によるローディングアニメーションを行う。

### 4.5.2 画面レイアウト

img

### 4.5.3 画面項目一覧

**凡例**

- **【種別】**
  A:リンク，B:ボタン，C:チェックボックス，D:カレンダ，L:ドロップダウンリスト，R:ラジオボタン，S:ラベル，T:テキストボックス，U:テキストエリア，I:画像，O:その他
- **【属性】**
  D:日付，F:全角，H:半角，M:全角半角混在，N:数値

| No   | 画面項目名       | 種別 | I/O  | 必須 | 属性 | 桁数 | API名       | 項目名                | 初期値 | 備考                                       |
| ---- | ---------------- | ---- | ---- | ---- | ---- | ---- | ----------- | --------------------- | ------ | ------------------------------------------ |
| 1    | スケルトン表示   | O    | -    | -    | -    | -    | -           | -                     | 表示   | API応答待機中に表示                        |
| 2    | Caseタイトル     | S    | O    | -    | F    | 100  | rag/predict | case_title            | -      | 例：「高圧電力線付近での感電事故」         |
| 3    | インシデント種別 | S    | O    | -    | F    | -    | rag/predict | incident_type         | -      | 「過去に起こったインシデント」など         |
| 4    | 概要             | S    | O    | -    | F    | -    | rag/predict | summary               | -      | 展開時に表示                               |
| 5    | 対応策タイトル   | S    | O    | -    | F    | -    | rag/predict | countermeasure_title  | -      | 3件想定                                    |
| 6    | 対応策詳細       | S    | O    | -    | F    | -    | rag/predict | countermeasure_detail | -      | 「目的」「実施内容」「実施者」をセット表示 |
| 7    | 戻るボタン       | B    | O    | -    | -    | -    | -           | -                     | -      | 入力画面（V000040）へ遷移                  |

<p style="text-align: center;"><strong>表 4.5-1 出力画面項目一覧</strong></p>

### 4.5.4. 画面アクション定義

| No   | イベント名       | アクションの処理詳細                                        | 遷移先画面名称（ID） |
| ---- | ---------------- | ----------------------------------------------------------- | -------------------- |
| 1    | API呼び出し      | 入力データをRAGサーバーへ送信し、類似インシデント結果を取得 | 自画面内更新         |
| 2    | カード押下       | 該当ケースの詳細情報（概要＋対応策3件）を展開／折りたたみ   | 同一画面             |
| 3    | 「戻る」クリック | 入力画面に戻る                                              | 入力画面（V000040）  |

<p style="text-align: center;"><strong>表 4.5-2 出力画面アクション定義一覧</strong></p>

### 4.4.5. バリデーション・エラー処理

| No   | エラー条件                  | エラーメッセージ                                             | 処理内容                                       | 備考           |
| ---- | --------------------------- | ------------------------------------------------------------ | ---------------------------------------------- | -------------- |
| 1    | API応答なし（タイムアウト） | 「予測結果の取得に失敗しました。時間をおいて再試行してください。」 | スケルトンを保持したままエラーメッセージを表示 | 通信エラー対応 |
| 2    | 結果件数0件                 | 「該当するインシデントは見つかりませんでした。」             | 空データメッセージを表示                       | 空検索対応     |
| 3    | JSON形式エラー              | 「結果データの読み込みに失敗しました。」                     | ログ記録、ユーザーには簡易メッセージのみ表示   | サーバー側検知 |
| 4    | 想定外エラー                | 「システムエラーが発生しました。」                           | エラーログ出力のみ                             | 一般例外       |

<p style="text-align: center;"><strong>表 4.5-3 エラー処理一覧</strong></p>

### 4.5.6 データ構造（共通仕様）

**RAG応答JSON構造例**

```JSON
{}
```

### 4.5.7 セキュリティ要件

- API通信は HTTPS（TLS1.2 以上）を使用。
- 応答データはクライアント側でキャッシュしない。
- 入力データ送信時に個人情報は含まない。
- エラーメッセージはユーザーに内部情報を開示しない。

### 4.5.8 表示制御（ComponentLabelMaster対応）

- 出力画面は基本的に**共通UI（ラベル固定）**として提供。
- テナントごとの見た目変更は非対象（※可視化は全テナント共通）。
