ドメイン取得後のTODOリスト / 手順書
1. 事前準備（レジストラ側）
[ ] ドメインの購入: お名前.com、Google Domains、AWS Route53 等でドメインを取得する。

例: ndk-ky.com

2. Terraformコードの修正（AWS側）
infrastructure/environments/dev/main.tf を開き、一時的に無効化（コメントアウト）していた箇所を復活させます。

A. 変数の更新
[ ] variable "root_domain" の default 値を取得したドメインに書き換える。

Terraform

variable "root_domain" {
  # ...
  default = "example.com" # ★ここを購入したドメインに変更
}
B. コメントアウトの解除
以下のブロックのコメントアウト # を外して有効化します。

[ ] 1. ネットワーク・DNS基盤 (Route53)

module "dns" ブロック全体

[ ] 2. SSL証明書 (ACM)

module "acm" ブロック全体

[ ] 9. DNSレコード登録 (API用サブドメイン)

resource "aws_route53_record" "api" ブロック全体

output "nameservers" ブロック全体

C. CDNモジュールの設定変更
[ ] module "cdn" 内のドメイン設定に値を入れる。

Terraform

module "cdn" {
  # ... (省略) ...

  # ★変更: 空文字だった場所に値を入れる
  acm_certificate_arn = module.acm.certificate_arn
  alias_domain        = "api.${var.root_domain}"
}
D. Outputの変更
[ ] output "api_endpoint_custom" の値を有効化する。

Terraform

output "api_endpoint_custom" {
  value = "https://api.${var.root_domain}"
}
3. デプロイとネームサーバー設定（最重要）
ここが一番のハマりポイントです。Terraform Apply しただけでは完了しません。

Terraform Apply 実行

Bash

terraform apply
※ ACM証明書の検証（Creating...）でTerraformが一時停止しますが、そのまま待ちます（長いと40分ほど待つことがありますが、手順2へ進んでください）。

ネームサーバー情報の取得

Applyの途中、または完了後に outputs に表示される nameservers の値（4行）をメモします。

例:

Plaintext

ns-123.awsdns-01.com
ns-456.awsdns-02.net
ns-789.awsdns-03.org
ns-012.awsdns-04.co.uk
レジストラ側での設定変更（手動作業）

ドメインを購入した管理画面（お名前.comなど）を開く。

「ネームサーバーの設定」項目を探す。

AWSから発行された上記4つのNSレコードに書き換える。

4. 待機と接続確認
ACM検証の完了

ネームサーバーが正しく切り替わると、AWS側で自動的にDNS検証が完了し、TerraformのApplyが成功して終了します。

疎通確認

ブラウザやcurlでアクセス確認。

URL: https://api.取得したドメイン/me

期待値: 認証エラー（401）またはデータ（200）が返ってくれば成功。

※ 403 Forbidden の場合はWAFが効いています。

※ Could not resolve host の場合はDNS反映待ち（最大24時間程度、通常数十分）。