## 4.4. 入力画面（V000040）

### 4.4.1. 概要

本画面は、作業前に「工事内容・工程・機材・現場状況」などを入力するための危険予知情報入力画面である。

ユーザーは、工事日程や工事種別などを選択し、必要な情報を入力した上で「検索」ボタンを押下することで、次の工程である危険予知結果（出力画面）へ遷移する。

本画面はテナント共通のデータ構造を持つが、表示項目やUI種別（ComboBox／CheckBox／TextBoxなど）はテナント設定（`ComponentLabelMaster`）により変更可能である。

### 4.4.2. 画面レイアウト

img

### 4.4.3 画面項目一覧

**凡例**

- **【種別】**
   A:リンク，B:ボタン，C:チェックボックス，D:カレンダ，L:ドロップダウンリスト，R:ラジオボタン，S:ラベル，T:テキストボックス，U:テキストエリア，I:画像，O:その他
- **【属性】**
   D:日付，F:全角，H:半角，M:全角半角混在，N:数値

| No   | 画面項目名       | 種別 | I/O  | 必須 | 属性 | 桁数 | API名                    | 項目名            | 初期値 | 備考                           |
| ---- | ---------------- | ---- | ---- | ---- | ---- | ---- | ------------------------ | ----------------- | ------ | ------------------------------ |
| 1    | 日付             | D    | I    | ○    | D    | 10   | form/construction        | construction_date | -      | カレンダー形式入力             |
| 2    | 工事種別         | L/C  | I    | ○    | M    | -    | form/construction        | construction_type | -      | ComboBoxまたはCheckboxで選択可 |
| 3    | 工事工程         | C    | I    | ○    | M    | -    | form/construction        | process_type      | -      | 複数選択可能（親＝工事種別）   |
| 4    | 注意が必要な機材 | C    | I    | -    | M    | -    | form/construction        | caution_equipment | -      | 工程選択により動的表示         |
| 5    | その他の機材     | C    | I    | -    | M    | -    | form/construction        | other_equipment   | -      | 固定リストから複数選択         |
| 6    | 現場状況         | C    | I    | ○    | M    | -    | form/construction        | site_condition    | -      | 気象・地盤・環境など選択       |
| 7    | 検索ボタン       | B    | O    | -    | -    | -    | form/construction/search | -                 | -      | 入力内容送信（出力画面へ遷移） |

<p style="text-align: center;"><strong>表 4.4-1 入力画面項目一覧</strong></p>

### 4.4.4. 画面アクション定義

| No   | イベント名       | アクションの処理詳細                                         | 遷移先画面名称（ID） |
| ---- | ---------------- | ------------------------------------------------------------ | -------------------- |
| 1    | 「検索」クリック | 入力値をバリデーション後、危険予知推論API（RAG）を呼び出し。応答結果を元に出力画面（危険予知結果）へ遷移。 | 出力画面（V000050）  |

<p style="text-align: center;"><strong>表 4.4-2 画面アクション定義一覧</strong></p>

### 4.4.5. バリデーション・エラー処理

| No   | 画面項目名 | チェック内容           | エラーメッセージ                                       | チェックタイミング |
| ---- | ---------- | ---------------------- | ------------------------------------------------------ | ------------------ |
| 1    | 日付       | 必須チェック           | 「日付を選択してください」                             | 「検索」押下時     |
| 2    | 工事種別   | 必須チェック           | 「工事種別を選択してください」                         | 「検索」押下時     |
| 3    | 現場状況   | 必須チェック           | 「現場状況を選択してください」                         | 「検索」押下時     |
| 4    | 工事工程   | 親項目未選択時の無効化 | 「工事種別を先に選択してください」                     | 入力時動的制御     |
| 5    | APIエラー  | 例外処理               | 「検索中にエラーが発生しました。再度お試しください。」 | 応答受信時         |

<p style="text-align: center;"><strong>表 4.4-3 バリデーション一覧</strong></p>

### 4.4.6 データ構造（共通仕様）

### **構造概要**

```json
construction_input = {
  construction_date: "YYYY-MM-DD",
  construction_type: [ "電気工事", "土木工事" ],
  process_type: [ "基礎工事", "鉄骨組立" ],
  caution_equipment: [ "高所作業車", "クレーン" ],
  other_equipment: [ "脚立", "ハンマー", "照明機器" ],
  site_condition: [ "気象条件", "地盤・地形", "周辺環境" ]
}
```

### **補足**

- `construction_type`, `process_type`, `caution_equipment` は **親子孫関係**で紐づく。
- すべてのテナントで共通のデータ構造を維持する（UI構成のみ可変）。
- 自由入力フィールドは `custom_fields[]` 配列として追加可能。

### 4.4.7 セキュリティ・その他要件

- 送信時は HTTPS（TLS1.2 以上）で暗号化通信。
- 未入力やAPIエラー時にはユーザーへ詳細を表示しない。
- UI側での一時キャッシュは保持しない。

### 4.4.8 表示制御（ComponentLabelMaster対応）

本画面は共通データ構造を持つが、ラベル・必須制御・UI種別・表示有無はテナント設定 (`ComponentLabelMaster`) によって変更される。

| 設定例                                                       | 説明                   |
| ------------------------------------------------------------ | ---------------------- |
| `"工事種別": { "label": "工事工程種別", "component_type": "ComboBox" }` | ラベル変更＋UI種別変更 |
| `"現場状況": { "visible": false }`                           | テナントで非表示設定   |
| `"自由入力1": { "label": "備考欄", "component_type": "TextBox" }` | 自由項目として追加表示 |