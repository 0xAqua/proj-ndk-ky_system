# 2. システム概要とデータ要件

## 2-1. システム構成概要

本システムは、AWS上に構築される中間システムを介して、VideoQuestor（RAGモデル） と連携し、過去のインシデント情報から類似事例と予防策を提示します。 DynamoDBは、ユーザー認証情報および入力画面用の階層型マスタデータの管理基盤 として利用されます。

### 2-1-1. 構成図

```
ここに簡単な全体の構成図を入れる
```

### 2-1-2. データフローの概要

本システムにおける主要なデータフローの概要は以下の通りです。

**認証フロー**

| ステップ | 実行元                 | 実行先                   | 処理                       |
| -------- | ---------------------- | ------------------------ | -------------------------- |
| 1        | ユーザー               | 中間システム (Cognito)   | ログインIDで認証リクエスト |
| 2        | 中間システム (Cognito) | DynamoDB (Usersテーブル) | ユーザー情報を照会・検証   |

**入力画面表示フロー**

| ステップ | 実行元                | 実行先                        | 処理                                                 |
| -------- | --------------------- | ----------------------------- | ---------------------------------------------------- |
| 1        | ユーザー              | 中間システム (Lambda)         | 入力画面の選択肢（マスタ）取得リクエスト             |
| 2        | 中間システム (Lambda) | DynamoDB (MasterDataテーブル) | 工事種別、作業、機材、現場状況の各マスタデータを取得 |

**インシデント検索フロー**

| ステップ | 実行元                | 実行先                | 処理                                           |
| -------- | --------------------- | --------------------- | ---------------------------------------------- |
| 1        | ユーザー              | 中間システム (Lambda) | 入力条件（工事種別、作業など）を送信           |
| 2        | 中間システム (Lambda) | VideoQuestor (RAG)    | 入力条件を整形して検索・予防策生成をリクエスト |
| 3        | VideoQuestor (RAG)    | 中間システム (Lambda) | 回答（類似インシデント、予防策）を返却         |
| 4        | 中間システム (Lambda) | ユーザー              | 回答を表示                                     |

## 2-2. データ要件

本システムは、複数テナント（組織・企業）が利用することを想定したマルチテナント設計を採用します。DynamoDBで管理する3つのテーブルのデータ要件は以下の通りです。

### 2-2-1. テナント情報（TenantMaster） 

テナント（組織・企業）の基本情報を管理します。

#### 管理項目

-  tenant_id: テナントの一意識別子（主キー） 
- テナント名: 組織・企業名
- ドメイン: テナントのドメイン情報 
- ステータス: テナント状態（有効/無効）
- 登録日時: テナント登録日時 
- 更新日時: 最終更新日時

### 2-2-2. ユーザー情報（UserMaster）

ユーザー認証およびアクセス制御に必要な情報を管理します。

#### 管理項目 

-  tenant_id: 所属テナントID（パーティションキー） 
- user_id: ユーザーの一意識別子（ソートキー） 
- ログインID: ログイン時に使用するID（Cognito連携用） 
- 氏名: ユーザーの氏名 
- メールアドレス: 連絡先メールアドレス 
- department_id: 所属部門ID（工事マスタと連携） 
- 権限レベル: アクセス権限（一般/管理者など） 
- 登録日時: ユーザー登録日時 
- 更新日時: 最終更新日時

### 2-2-3. 工事マスタ情報（ConstructionMaster）

入力画面の選択肢として提供する、階層構造を持つマスタデータを管理します。

階層構造： 

本マスタデータは以下の4階層で構成されます。

- レベル1: 部門（Department）
- レベル2: 工事種別（ConstructionType）
- レベル3: 工事工程（ConstructionProject）
- レベル4: 作業内容（Task）
- レベル5: 機材（Equipment）

#### 管理項目 

- tenant_id: 所属テナントID（パーティションキー） 
- nodePath: 階層パス（ソートキー、例：DEPT#1#TYPE#1#PROJ#1） 
- type: アイテム種別（Department/ConstructionType/Task/Equipmentなど） 
- name: 表示名 
- 表示順: 同一階層内での並び順
- ステータス: マスタ状態（有効/無効） 
- 登録日時: マスタ登録日時
- 更新日時: 最終更新日時