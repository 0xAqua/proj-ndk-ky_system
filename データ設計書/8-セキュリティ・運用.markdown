# 8. セキュリティ・運用設計

本章では、本システムの安定稼働と情報保護を目的として、セキュリティ、ログ管理、バックアップ、監査、運用体制に関する設計方針を定義します。
システム全体は AWS マネージドサービス（Cognito, API Gateway, Lambda, DynamoDB, CloudWatch 等）を活用し、セキュリティと運用負荷の最適化を図ります。

## 8-1. セキュリティ設計方針

| 項目                   | 内容                                                         |
| ---------------------- | ------------------------------------------------------------ |
| **認証基盤**           | Amazon Cognito によるユーザー認証                            |
| **認可制御**           | Cognito グループ（Admin／User）および `role` 属性に基づく制御 |
| **データ分離**         | すべての DynamoDB テーブルに `tenant_id` を必須キーとして保持し、他テナントアクセスを論理的に遮断 |
| **通信経路**           | API Gateway〜Lambda〜DynamoDB 間はすべて AWS 内部通信（VPC エンドポイント経由） |
| **暗号化**             | DynamoDB・S3 は KMS によるサーバーサイド暗号化（SSE-KMS）を有効化 |
| **秘密情報管理**       | Cognito クライアントID／JWT署名鍵／環境変数／VQ API Key は AWS Secrets Manager で集中管理 |
| **パスワードポリシー** | エクシオグループのセキリュティ基準に準拠                     |

## 8-2. 監査・ログ設計

| ログ種別                 | 保存先                        | 保持期間 | 内容                                              |
| ------------------------ | ----------------------------- | -------- | ------------------------------------------------- |
| **認証ログ**             | Cognito CloudWatch Logs       | ??日     | ログイン／ログアウト／認証失敗                    |
| **APIアクセスログ**      | API Gateway Logs              | ??日     | エンドポイント、HTTPメソッド、呼出元IP、tenant_id |
| **アプリケーションログ** | CloudWatch Logs（Lambda）     | ??日     | 操作内容、入力パラメータ、結果、エラー            |
| **データ変更履歴**       | DynamoDB Streams + S3 Archive | 永続     | 更新・削除イベントを履歴保存                      |